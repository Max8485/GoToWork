<?xml version="1.0" encoding="UTF-8"?>
<!--<configuration>-->
<!--    <include resource="org/springframework/boot/logging/logback/base.xml"/>-->

<!--        <springProperty scope="context" name="environment" source="ENVIRONMENT"/>-->
<!--    <springProfile name="!dev">-->
<!--        <appender name="logstash" class="net.logstash.logback.appender.LogstashTcpSocketAppender">-->
<!--            <destination>194.87.237.197:50000</destination>-->
<!--            <encoder charset="UTF-8" class="net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder">-->
<!--                <providers>-->
<!--                    <mdc/>-->
<!--                    <context/>-->
<!--                    <logLevel/>-->
<!--                    <loggerName/>-->
<!--                    <pattern>-->
<!--                        <pattern>-->
<!--                            {-->
<!--                            "app": "go-to-work-core",-->
<!--                            "message": "%message%n%ex{full}",-->
<!--                            "environment": "${environment}"-->
<!--                            }-->
<!--                        </pattern>-->
<!--                    </pattern>-->
<!--                    <threadName/>-->
<!--                    <logstashMarkers/>-->
<!--                </providers>-->
<!--            </encoder>-->
<!--        </appender>-->
<!--        <root level="info">-->
<!--            <appender-ref ref="logstash"/>-->
<!--        </root>-->
<!--    </springProfile>-->
<!--</configuration>-->

<configuration>
    <include resource="org/springframework/boot/logging/logback/base.xml"/>

    <springProperty scope="context" name="environment" source="ENVIRONMENT" defaultValue="dev"/>
    <springProperty scope="context" name="appName" source="spring.application.name" defaultValue="go-to-work-core"/>

    <!-- PROD профиль - логи в Elasticsearch + консоль -->
    <springProfile name="prod">
        <appender name="LOGSTASH" class="net.logstash.logback.appender.LogstashTcpSocketAppender">
            <destination>194.87.237.197:50000</destination>
            <reconnectionDelay>10000</reconnectionDelay>
            <connectionTimeout>15000</connectionTimeout>

            <encoder charset="UTF-8" class="net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder">
                <providers>
                    <timestamp>
                        <timeZone>UTC</timeZone>
                        <fieldName>@timestamp</fieldName>
                    </timestamp>
                    <logLevel/>
                    <loggerName/>
                    <message/>
                    <threadName/>
                    <stackTrace/>
                    <pattern>
                        <pattern>
                            {
                            "app": "${go-to-work-core}",
                            "message": "%message",
                            "environment": "${environment}",
                            "stack_trace": "%ex{full}"
                            }
                        </pattern>
                    </pattern>
                </providers>
            </encoder>
        </appender>

        <root level="INFO">
            <appender-ref ref="LOGSTASH"/>
            <appender-ref ref="CONSOLE"/>
        </root>
    </springProfile>

    <!-- DEV профиль - только консоль -->
    <springProfile name="dev">
        <root level="DEBUG">
            <appender-ref ref="CONSOLE"/>
        </root>

        <logger name="org.maxsid.work.bot" level="DEBUG"/>
        <logger name="org.springframework.web" level="DEBUG"/>
    </springProfile>
</configuration>